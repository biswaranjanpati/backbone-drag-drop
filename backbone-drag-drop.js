// Generated by CoffeeScript 1.4.0
(function() {
  var __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
    __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  (function() {
    Backbone.DraggableModel = (function(_super) {

      __extends(DraggableModel, _super);

      function DraggableModel() {
        return DraggableModel.__super__.constructor.apply(this, arguments);
      }

      return DraggableModel;

    })(Backbone.Model);
    Backbone.DroppableCollection = (function(_super) {

      __extends(DroppableCollection, _super);

      function DroppableCollection() {
        this._remove = __bind(this._remove, this);

        this._add = __bind(this._add, this);
        return DroppableCollection.__super__.constructor.apply(this, arguments);
      }

      DroppableCollection.prototype.initialize = function() {
        this.on("add", this._add);
        return this.on("remove", this._remove);
      };

      DroppableCollection.prototype._add = function(model) {
        if ((this.view != null) && model.view) {
          return this.view.$el.append(model.view.$el);
        }
      };

      DroppableCollection.prototype._remove = function(model) {
        if (model.view != null) {
          return model.view.$el.detach();
        }
      };

      return DroppableCollection;

    })(Backbone.Collection);
    Backbone.DraggableView = (function(_super) {

      __extends(DraggableView, _super);

      function DraggableView() {
        this.didDrop = __bind(this.didDrop, this);

        this.canDrop = __bind(this.canDrop, this);

        this._didDrop = __bind(this._didDrop, this);

        this._canDrop = __bind(this._canDrop, this);

        this.draggable = __bind(this.draggable, this);
        return DraggableView.__super__.constructor.apply(this, arguments);
      }

      DraggableView.prototype.initialize = function() {
        return this.model.view = this;
      };

      DraggableView.prototype.draggable = function(options) {
        if (options == null) {
          options = {};
        }
        options.canDrop = this._canDrop;
        options.didDrop = this._didDrop;
        this.$el.dragdrop(options);
        this.$el.data('view', this);
        return this.$el.data('model', this.model);
      };

      DraggableView.prototype._canDrop = function(el) {
        var droppable_view;
        droppable_view = $(el).data('view');
        if (!droppable_view || !(droppable_view instanceof Backbone.DroppableView)) {
          return false;
        }
        return droppable_view.canDrop(this) && this.canDrop(droppable_view);
      };

      DraggableView.prototype._didDrop = function(src, dst) {
        var draggable_model, draggable_view, droppable_view, dst_collection, src_collection;
        draggable_view = src.data('view');
        draggable_model = src.data('model');
        droppable_view = dst.data('view');
        src_collection = draggable_view.$el.parent().data('collection');
        dst_collection = dst.data('collection');
        if (src_collection != null) {
          src_collection.remove(draggable_model);
          droppable_view.trigger("remove");
        }
        if (dst_collection != null) {
          dst_collection.add(draggable_model);
          droppable_view.trigger("add");
        }
        draggable_view.trigger("drag");
        draggable_model.trigger("drag");
        return this.didDrop(draggable_view, droppable_view);
      };

      DraggableView.prototype.canDrop = function(droppable_view) {
        return true;
      };

      DraggableView.prototype.didDrop = function(draggable_view, droppable_view) {};

      return DraggableView;

    })(Backbone.View);
    return Backbone.DroppableView = (function(_super) {

      __extends(DroppableView, _super);

      function DroppableView() {
        this.canDrop = __bind(this.canDrop, this);

        this.droppable = __bind(this.droppable, this);
        return DroppableView.__super__.constructor.apply(this, arguments);
      }

      DroppableView.prototype.droppable = function(options) {
        if (options == null) {
          options = {};
        }
        this.$el.data('view', this);
        this.$el.data('collection', this.collection);
        return this.collection.view = this;
      };

      DroppableView.prototype.canDrop = function(draggable_view) {
        return true;
      };

      return DroppableView;

    })(Backbone.View);
  }).call(this);

}).call(this);
